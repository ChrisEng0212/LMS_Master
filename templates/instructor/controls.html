{% extends "layout.html" %}

{% block content %}

<div id="vue-app">

<span id="attend_string" style="display:none">{{attend_list}}</span>
<span id="team_string" style="display:none">{{team_list}}</span>

<div class="content-section">    
     <legend class="border-bottom mb-4">Controls</legend>
 

<button class="btn btn-outline-warning" @click="setAtt()"> Set Att </button>
Notice <input type="text" class="textAss" id="notice" style="margin-left:5px"></input> 
&nbsp&nbsp&nbsp
Unit
<select id="unit" name="units">
<template v-for="i in unit_list">
    <option :value="i">[[i]]</option>
</template>
</select>
&nbsp&nbsp&nbsp
Set: <span> [[ setOBJ['set_mode'] ]] </span>
<select id="set" name="cars">  
    <option value="97">Closed</option>
    <option value="98">Open</option>
    <option value="99">Late</option>
    <option value="50">Review</option>
    <option value="51">Review Late</option>
    <option value="100">Clear</option>  
</select>
&nbsp&nbsp&nbsp
Teamcount
<select id="teamcount" name="cars">
<template v-for="i in team_list">
    <option :value="i">[[i]]</option>
</template>
</select>
&nbsp&nbsp&nbsp
Teamsize
<select id="teamsize" name="cars">
<template v-for="i in size_list">
    <option :value="i">[[i]]</option>
</template>
</select>
&nbsp&nbsp&nbsp

<br>
<br>
<a href='https://affairs.just.edu.tw/TeacherStuApp/Default.aspx'> Attendance</a>
&nbsp
&nbsp
<a href='http://deanapp.just.edu.tw/teacher/Default.aspx'>Syllabus</a>
&nbsp
&nbsp
<a href='https://md.just.edu.tw/login/index.php'>Moodle</a>
&nbsp
&nbsp
<a href='https://hrapp.just.edu.tw/hr_personal/Default.aspx'>Personnel</a> 
&nbsp
&nbsp
    
</div>

<div class="content-section"> 
        <legend class="border-bottom mb-4">Students</legend>
    
    <div style="overflow-x:auto;width:80%">
      <table class="table table-sm">
        <thead>
            <tr>
              <th scope="col" >Img</th>  
              <th scope="col" >Name</th>                                  
              <th scope="col" >ID</th>                       
              <th scope="col" >att</th>                       
              <th scope="col" >email</th>  
              <th scope="col" ></th>  
            </tr>
        </thead> 
        
        <tbody>
        <template v-for="(user, key) in attendOBJ">             
            <tr>
              <td> <img class="rounded-circle small-img" :src="user.img"></td>  
              <td> [[ key ]] </td>  
              <td> [[ user.idn]] </td>  
              <td :style="attStyle(user.att)"> [[ user.att ]] </td>  
              <td> <a :href="user.eml">Email</a> </td> 
              <td>  <span> remove </span> </td> 

            </tr>  
        </template>                 
        </tbody>   
   
      </table>
    </div>

</div> 

<div class="content-section"> 
        <legend class="border-bottom mb-4">Teams</legend>
    
    <div style="overflow-x:auto;width:80%">
      <table class="table table-sm">
        
        <tbody>
        <template v-for="(team, number) in teamOBJ">             
            <tr>
              <td> [[ number ]] </td>
              <template v-for="mem in team">    
              <td> <span style="padding:5px; font-size:12px;background:lightcoral;width:100px;border:1px sold white; border-radius:5px" justify="right" @click="deleteStudent(mem)"> [[ mem ]] </span> </td>
              <div v-if="studentList(mem)">
                <button class="btn btn-sm btn-danger" @click="studentRemove(mem)">[[ mem ]]</button> </td>  
              </div>
              </template>    
            </tr>  
        </template>     
            
        </tbody>   
   
      </table>
    </div>

</div>   
   

   

</div> <!-- end of Vue app -->


{% endblock %}

{% block script %}   

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>

<script type="text/javascript" >

var attend_list = document.getElementById('attend_string').innerHTML
var attendOBJ = JSON.parse(attend_list)
console.log('AttOBJ', attendOBJ);
var team_list = document.getElementById('team_string').innerHTML
var teamOBJ = JSON.parse(team_list)
console.log('teamOBJ', teamOBJ);


startVue(attendOBJ, teamOBJ)

function startVue(attendOBJ, teamOBJ){ new Vue({   

    el: '#vue-app',
    delimiters: ['[[', ']]'],
    mounted: function(){
        
    },
    data: {
        attendOBJ : attendOBJ, 
        teamOBJ : teamOBJ,
        setOBJ : {
            set_mode : 'closed',
        },
        studentList : {

        },
        
        unit_list : ['RR','00', '01','02','03','04','05','06','07','08','09', '10'],       
        size_list : ['4','0', '3','5'] ,   
        team_list : ['5','6', '7','8','9', '10','11','12','13','14','15','16','17','18','19','20'],       
    }, 
    methods: {   
        setAtt: function() { 
          
          this.setOBJ['notice'] = document.getElementById('unit').value

          // vanila js
          var e = document.getElementById('unit')
          this.setOBJ['unit'] = e.options[e.selectedIndex].value

          this.setOBJ['set_mode'] = $("#set :selected").val();
          this.setOBJ['teamsize'] = $("#teamsize :selected").val();
          this.setOBJ['teamcount'] = $("#teamcount :selected").val();

          console.log(this.setOBJ);            

            $.ajax({
              data : {
                setOBJ : JSON.stringify(this.setOBJ),                
              },
              type : 'POST',
              url : '/updateSet',               
            })
            .done(function(data) { 

              alert('Attendance Updated: count ' + data.teamcount)                
            })
            .fail(function(){
                alert('error has occurred');
            });
        },                          
        attStyle: function(att) {
          if (att == 'Absent') {
            return { background:'lightcoral'}
          }          
          else if (att == 'On time') {
            return { background:'mediumseagreen'}
          }          
          else if (att == 'Late') {
            return { background:'lightgrey'}
          } 
        },                  
        deleteStudent: function(mem) {
          if (studentList[mem] ){
            studentList[mem] = false 
          }
          else{
            studentList[mem] = true 
          }
          
        },                  
        studentRemove: function(mem) {
          $.ajax({
              data : {
                name : mem
              },
              type : 'POST',
              url : '/studentRemove'         
                  
          })
		      .done(function(data) {  
            vue.studentList[mem] = false        
            alert('student removed:' + mem)
                           
		      })
          .fail(function(){
                alert('error has occurred');
          });
        },                  
    }         
})// end NEW VUE



}// endFunction 

</script> 


{% endblock %} 

