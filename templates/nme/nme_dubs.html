{% extends "layout.html" %}

{% block content %}

<div id="vue-app">

<div class="content-section">
        <h1> Movie Projects </h1>
</div>

<div class="content-section">
  <video style="width:100%" id="vid" src="" controls playsinline  ></video>

  <div >
   <audio controls id="handler" style="display:inline"> </audio>  <button class="btn btn-danger" @click="stopAudio()"> Stop </button>
  </div>
  <div >
    Delay (1000 = 1 sec) <input style='integer' v-model="milli"> </input>
  </div>

  <div style="overflow-x:auto;">
    <table class="table table-sm">
      <tbody>
      <template v-for="(movie, key) in projectOBJ" :key="key">

        <tr>
          <td>
           [[ payOBJ[key].title ]]
          </td>
         <template  v-for="(n, team) in teamDict" :key="team">
            <td v-if="movie[team] && movie[team]['audio']">
            <button class="btn btn-info" @click="playAudio(movie[team]['audio'], key)"> [[team]]</button>
            </td>
            <td v-else="movie[team]">
            <button class="btn btn-danger"> [[team]] </button>
            </td>
      </template>
      </tr>
      </template>

      </tbody>

    </table>
  </div>

  [[teamDict]]



</div>

<span id="projectDict" style="display:none">{{nmeString}}</span>
<span id="payloadDict" style="display:none">{{payString}}</span>


</div> <!-- end of Vue app -->


{% endblock %}

{% block script %}

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>

<script type="text/javascript" >

var projectDict = document.getElementById('projectDict').innerHTML
var payloadDict = document.getElementById('payloadDict').innerHTML
var OBJ = JSON.parse(projectDict)
var PAY = JSON.parse(payloadDict)
console.log('projectDict', OBJ);
console.log('payloadDict', PAY);


startVue()

function startVue(){ new Vue({

    el: '#vue-app',
    delimiters: ['[[', ']]'],
    data: {
        projectOBJ: OBJ,
        payOBJ: PAY,
        show: null,
        milli: null,
        md: 6,
        teamDict:  {
          21:["Wendy", "Sakura ", "Amber"],
          22:["Kai", "Gillian", "Benson"],
          23:["Bruce", "Kenny", "Bob"],
          24:["Alina", "Monica", "Emma"],
          25:["Una", "Sara", "Michelle"],
          26:["Carol", "Elsa", "Yui"],
          27:["Felisia", "Disa", "Devi"],
          28:["Eric", "Rebecca", "Raymond"],
          29:["Jerry", "Owen", "Max"],
          30:["Vellna", "Emmy", "Sherry"],
          31:["Jason", "SamTsai", "Peggy"],
          32:["William", "Winnie", "Coral"],
          33:["Teresa", "Connor", "Clare "]
        }
    },
    methods: {
        goTo: function(key) {

          // go to HTTPS version
          var str = window.location.href

          let url = (str).split('_dash')[0] + '_check/' + key
          console.log('goTO', url);
            window.location = url
            console.log('DONE');
        },
        playAudio: function (arg, mov) {
          console.log(arg)
          let audio = document.getElementById('handler')
          audio.src = arg
          audio.pause()
          audio.currentTime = 0

          let video = document.getElementById('vid')
          video.muted = true
          video.src = this.payOBJ[mov].subtitles
          video.pause()
          video.currentTime = 0
          audio.play()

          setTimeout(func, this.milli)
                function func(){video.play()}
        },
        stopAudio: function () {
          let audio = document.getElementById('handler')
          audio.pause()
          audio.currentTime = 0

          let video = document.getElementById('vid')
          video.muted = true
          video.pause()
          video.currentTime = 0

        },


    }
})// end NEW VUE



}// endFunction

</script>

{% endblock %}

