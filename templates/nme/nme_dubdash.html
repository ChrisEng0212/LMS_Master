{% extends "layout.html" %}

{% block content %}

<span id="projectDict" style="display:none">{{nmeString}}</span>

<div id="vue-app">

<div class="content-section">
        <h1> Movie Projects </h1>

</div>

<div class="content-section">

    <div style="overflow-x:auto;">
      <table class="table table-sm">
        <thead>
            <tr>
              <th scope="col" >Movie</th>
              <th scope="col" >Names</th>
              <th scope="col" >0</th>
              <th scope="col" >1</th>
              <th scope="col" >2</th>
              <th scope="col" >3</th>
              <th scope="col" >4</th>
            </tr>
        </thead>

        <tbody>
        <template v-for="(movie, key) in projectOBJ" :key="key">
          <template  v-for="(proj, team) in movie" :key="team">
          <tr>
              <td>
              [[team]]
              </td>
              <td>
              [[proj.names]]
              </td>
              <td>
              [[proj.q01]]
              [[proj.q02]]
              </td>
              <td>
              [[proj.q11]]
              [[proj.q12]]
              </td>
              <td>
              [[proj.q21]]
              [[proj.q22]]
              [[proj.q23]]
              </td>
              <td>
              [[proj.q31]]
              [[proj.q32]]
              [[proj.q33]]
              </td>
              <td>
              <audio id="aud" :src="proj.audio" controls ></audio>
              </td>

          </tr>

        </template>

        </tbody>

      </table>
    </div>

</div>


</div> <!-- end of Vue app -->


{% endblock %}

{% block script %}

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>

<script type="text/javascript" >

var projectDict = document.getElementById('projectDict').innerHTML
var OBJ = JSON.parse(projectDict)
console.log('projecDict', OBJ);


startVue(OBJ)

function startVue(OBJ){ new Vue({

    el: '#vue-app',
    delimiters: ['[[', ']]'],
    data: {
        projectOBJ: OBJ,
        showSums: null
    },
    methods: {
        goTo: function(key) {

          // go to HTTPS version
          var str = window.location.href

          let url = (str).split('_dash')[0] + '_check/' + key
          console.log('goTO', url);
            window.location = url
            console.log('DONE');
        },
        sumsLength: function (name, novel) {
          let sums = this.projectOBJ[novel][name]['sums']
          let count = 0
          for (let chapter in sums){
              count +=1
          }
          return count
        },
        rowStyle: function (x,y,key) {
          if (parseInt(x) === parseInt(y) && key === '01') {
            return 'background:lightgreen'
          }
          if (parseInt(x) === parseInt(y) && key === '02') {
            return 'background:lightblue'
          }
          if (key === '02') {
            return 'background:lightgrey'
          }
        },
        recsLength: function (name, novel) {
          let recs = this.projectOBJ[novel][name]['recs']
          let count = 0
          for (let rec in recs){
            if (recs[rec]['audio']) {
              count +=1
            }
          }
          return count
        },
        updateSum: function (name, novel, number, summary) {
          console.log('update via AJAX');
          let _this = this
            $.ajax({
              data : {
                novel: novel,
                number: number,
                name: name,
                summary: summary
              },
              type : 'POST',
              url : '/updateSum',
            })
            .done(function(data) {
              alert(data.success)
            })
            .fail(function(){
                console.log('error has occurred');
            });
        },

    }
})// end NEW VUE



}// endFunction

</script>

{% endblock %}

